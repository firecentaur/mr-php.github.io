---
layout: post
title: Override Apache Settings Per Site in cPanel
created: 1272617503
---
<p>I have a domain where I keep all my pictures and I would like to be able to use multiple domains to access those images.</p>

<p>"Well that's easy", I hear you saying.  "Just use <i>parked</i> or <i>addon</i> Domains".</p>

<p>Yes that's a fantastic solution... Unless you need to have an SSL certificate on the site.  The problem is that you can only install 1 SSL certificate per site, and the SSL certificate must match only one domain name.</p>

<!--break-->

<p>The solution is to edit the <b>httpd.conf</b> file, <u>however thats a big no-no</u> when it comes to cpanel, because the config file will be automatically overwritten by cpanel.</p>

<p>There may also be other reasons to have the domains on separate sites, such as the ability to track apache statistics separately.  There may also be other reasons to override the apache config, such as setting up wildcard subdomains.</p>


<h2>Override Apache Settings Per Site</h2>

<p>Lets assume <b>example.com</b> is the domain we want to serve from another users public_html.</p>

<p>The first thing to do is open <b>/etc/httpd/conf/httpd.conf</b>.  At the top you will see this message:</p>

<pre class="brush:bash">
Direct modifications to the Apache configuration file may be lost upon subsequent regeneration of the       
configuration file. To have modifications retained, all modifications must be checked into the              
configuration system by running:                                                                            
    /usr/local/cpanel/bin/apache_conf_distiller --update                                                    
To see if your changes will be conserved, regenerate the Apache configuration file by running:              
    /usr/local/cpanel/bin/build_apache_conf                                                                 
and check the configuration file for your alterations. If your changes have been ignored, then they will    
need to be added directly to their respective template files. 
</pre>

<p>Basically this means do not edit this file.  Instead we have to edit an include file.  To get the filename of the include file you will need to find the lines below.  They will be specific to your domain and there will be 2 files if you have SSL.</p>

<pre class="brush:xml">
&lt;VirtualHost 123.123.123.123:80>

    ..trimmed..

    # To customize this VirtualHost use an include file at the following location
    # Include "/usr/local/apache/conf/userdata/std/2/example/example.com/*.conf"
&lt;/VirtualHost>
</pre>

<pre class="brush:xml">
&lt;VirtualHost 123.123.123.123:443>

    ..trimmed..

    # To customize this VirtualHost use an include file at the following location
    # Include "/usr/local/apache/conf/userdata/ssl/2/example/example.com/*.conf"
&lt;/VirtualHost>
</pre>

<p>So we will need to create the following 2 files (you can call them anything, I just used 'mystuff' as an example.):</p>
<ul>
<li>/usr/local/apache/conf/userdata/std/2/example/example.com/mystuff.conf</li>
<li>/usr/local/apache/conf/userdata/ssl/2/example/example.com/mystuff.conf</li>
</ul>

<p>The contents of the files can basically be anything from the <b>..trimmed..</b> section that you need to override.</p>


<h2>Serve Files from Another public_html</h2>

<p>Lets assume our other user is <i>pictures</i> with a web path of <b>/home/pictures/public_html</b>.</p>

<p>You will need to copy everything in the <b>..trimmed..</b> section that mentions your user <i>example</i>, and paste it into <b>mystuff.conf</b>.  Now you will need to replace all instances of <i>example</i> with <i>pictures</i>.</p>


<h2>Wildcard Subdomains</h2>

<p>Simply add this line into your <b>mystuff.conf</b>.</p>

<pre class="brush:plain">
ServerAlias *.example.com
</pre>

<p>You will also need to add an A record mapped to * (asterisk) for the subdomain. </p>

<h2>Rebuild httpd.conf</h2>

<p>Run the following commands to update the httpd.conf with your changes.</p>

<pre class="brush:bash">
/usr/local/cpanel/bin/apache_conf_distiller â€“update
/usr/local/cpanel/bin/build_apache_conf
</pre>

<p>You will notice the <b>httpd.conf</b> is now slightly different:</p>

<pre class="brush:xml">
&lt;VirtualHost 123.123.123.123:80>

    ..trimmed..

    Include "/usr/local/apache/conf/userdata/std/2/example/example.com/*.conf"
&lt;/VirtualHost>
</pre>


<p>Now simply restart apache and your include file will be active!</p>
<pre class="brush:bash">
service httpd restart
</pre>
